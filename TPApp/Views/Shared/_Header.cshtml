@inject IHttpContextAccessor HttpContextAccessor
@inject Microsoft.AspNetCore.Identity.UserManager<TPApp.Entities.ApplicationUser> UserManager
@inject Microsoft.Extensions.Configuration.IConfiguration Configuration
@{
    var MainDomain = Configuration["AppSettings:MainDomain"] ?? "https://localhost:7232/";
    var userName = HttpContextAccessor.HttpContext.Session.GetString("Username");
    var userAvatar = "";
    
    if (!string.IsNullOrEmpty(userName))
    {
        var user = await UserManager.FindByNameAsync(userName);
        if (user != null && !string.IsNullOrEmpty(user.Img))
        {
            userAvatar = user.Img;
        }
    }
}

<header class="hp-header navbar navbar-expand-lg">
    <div class="container">
        <div class="header-mobile">
            <div class="d-flex align-items-center">
                <button class="navbar-toggler me-2"
                        type="button"
                        data-bs-toggle="offcanvas"
                        data-bs-target="#hpOffcanvas">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <a href="@MainDomain"
                   class="navbar-brand d-lg-none p-0">
                    <img src="@($"{MainDomain}image/logo.png")"
                         alt="Techport"
                         class="hp-header-logo"
                         onerror="this.src='/image/default-logo.png'">
                </a>
            </div>
            <div class="d-lg-none d-flex">
                <form action="/Search/Index" method="get" class="hp-header-search-container mobile">
                    <i class="bi bi-search hp-header-search-icon"></i>
                    <input type="text"
                           name="q"
                           class="hp-header-search-input"
                           placeholder="Tìm công nghệ / Thiết bị / Nhà cung ứng"
                           required>
                    <button type="submit" class="hp-header-search-submit" style="display:none;"></button>
                </form>
                @if (string.IsNullOrEmpty(userName))
                {
                    <a href="#"
                       class="hp-header-btn-login"
                       data-bs-toggle="modal"
                       data-bs-target="#loginModal">
                        <i class="bi bi-person-circle" style="font-size: 24px;"></i>
                    </a>
                }
                else
                {
                    <div class="dropdown">
                        <a href="#"
                           class="hp-user-avatar-btn dropdown-toggle"
                           data-bs-toggle="dropdown"
                           aria-expanded="false">
                            <img src="@(!string.IsNullOrEmpty(userAvatar) ? userAvatar : "/image/default-avatar.png")"
                                 alt="@userName"
                                 class="hp-user-avatar"
                                 onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2240%22%3E%3Ccircle cx=%2220%22 cy=%2220%22 r=%2220%22 fill=%22%230056b3%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22white%22 font-size=%2218%22 font-weight=%22bold%22%3E@userName.Substring(0, 1).ToUpper()%3C/text%3E%3C/svg%3E'">
                            <span class="hp-user-name d-none">@userName</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end hp-user-dropdown">
                            <li>
                                <a class="dropdown-item" href="@($"{MainDomain}Dashboard")">
                                    <i class="bi bi-speedometer2 me-2"></i>Dashboard
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form asp-controller="Account" asp-action="Logout" method="post" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="dropdown-item text-danger">
                                        <i class="bi bi-box-arrow-right me-2"></i>Đăng xuất
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </div>
                }
            </div>
        </div>
        <!-- DESKTOP -->
        <div class="d-none d-lg-flex align-items-center justify-content-between w-100">

            <!-- LEFT -->
            <div class="d-flex align-items-center gap-4">

                <a href="@MainDomain" class="navbar-brand p-0">
                    <img src="@($"{MainDomain}image/logo.png")"
                         alt="Techport"
                         class="hp-header-logo"
                         onerror="this.src='/image/default-logo.png'">
                </a>

                <div class="dropdown">
                    <button class="hp-header-btn-menu dropdown-toggle"
                            data-bs-toggle="dropdown">
                        <i class="bi bi-list"></i> Danh mục
                    </button>

                    <div class="dropdown-menu p-3" style="min-width:450px;">
                        <div class="row g-3">
                            <div class="col-6">
                                <h6>Công nghệ & Thiết bị</h6>
                                <a class="dropdown-item" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/dien-dien-tu-cong-nghe-thong-tin-4.html")">Điện, điện tử, CNTT</a>
                                <a class="dropdown-item" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/vat-lieu-luyen-kim-7.html")">Vật liệu & luyện kim</a>
                                <a class="dropdown-item" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/moi-truong-9.html")">Môi trường</a>
                                <a class="dropdown-item" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/cong-nghe-nano-11.html")">Công nghệ Nano</a>
                                <a class="dropdown-item" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/duoc-hoc-13.html")">Dược học</a>
                                <a class="dropdown-item" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/chan-nuoi-15.html")">Chăn nuôi</a>
                                <a class="dropdown-item" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/thuy-san-18.html")">Thuỷ sản</a>
                            </div>
                            <div class="col-6">
                                <h6>&nbsp;</h6>
                                <a class="dropdown-item" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/co-khi-5.html")">Cơ khí</a>
                                <a class="dropdown-item" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/y-hoc-8.html")">Y học</a>
                                <a class="dropdown-item" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/cong-nghe-sinh-hoc-10.html")">Công nghệ sinh học</a>
                                <a class="dropdown-item" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/cong-nghe-thuc-pham-12.html")">Công nghệ thực phẩm</a>
                                <a class="dropdown-item" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/trong-trot-14.html")">Trồng trọt</a>
                                <a class="dropdown-item" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/lam-nghiep-17.html")">Lâm nghiệp</a>
                            </div>
                        </div>
                    </div>
                </div>

                <nav class="navbar-nav d-flex align-items-center gap-3">
                    <a href="@($"{MainDomain}gioi-thieu-chung-3.html")" class="hp-header-link nav-link">Giới thiệu</a>
                    <a href="https://techport.vn/startup-products/" class="hp-header-link nav-link">Sản phẩm khởi nghiệp</a>
                    <a href="https://techport.vn/tech-event/" class="hp-header-link nav-link">Tech event</a>
                    <a href="@($"{MainDomain}thao-luan.html")" class="hp-header-link nav-link">Thảo luận</a>
                    <a href="@($"{MainDomain}lien-he-74.html")" class="hp-header-link nav-link">Liên hệ</a>
                </nav>
            </div>

            <!-- RIGHT -->
            <div class="d-flex align-items-center gap-3">
                <form action="/Search/Index" method="get" class="hp-header-search-container">
                    <i class="bi bi-search hp-header-search-icon"></i>
                    <input type="text"
                           name="q"
                           class="hp-header-search-input"
                           placeholder="Tìm công nghệ / Thiết bị / Nhà cung ứng"
                           required>
                    <button type="submit" class="hp-header-search-submit" style="display:none;"></button>
                </form>




                @if (string.IsNullOrEmpty(userName))
                {
                    <a href="#" 
                       class="hp-header-btn-login"
                       data-bs-toggle="modal" 
                       data-bs-target="#loginModal">
                        <i class="bi bi-person-circle" style="font-size: 24px;"></i>
                    </a>
                }
                else
                {
                    <div class="dropdown">
                        <a href="#" 
                           class="hp-user-avatar-btn dropdown-toggle" 
                           data-bs-toggle="dropdown" 
                           aria-expanded="false">
                            <img src="@(!string.IsNullOrEmpty(userAvatar) ? userAvatar : "/image/default-avatar.png")" 
                                 alt="@userName" 
                                 class="hp-user-avatar"
                                 onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2240%22%3E%3Ccircle cx=%2220%22 cy=%2220%22 r=%2220%22 fill=%22%230056b3%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22white%22 font-size=%2218%22 font-weight=%22bold%22%3E@userName.Substring(0, 1).ToUpper()%3C/text%3E%3C/svg%3E'">
                            <span class="hp-user-name d-none">@userName</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end hp-user-dropdown">
                            <li>
                                <a class="dropdown-item" href="@($"{MainDomain}Dashboard")">
                                    <i class="bi bi-speedometer2 me-2"></i>Dashboard
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form asp-controller="Account" asp-action="Logout" method="post" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="dropdown-item text-danger">
                                        <i class="bi bi-box-arrow-right me-2"></i>Đăng xuất
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </div>
                }
                <!-- Language Selector -->
                <a class="hp-lang-btn" href="https://techport.vn/en/index.html" title="English">
                    <img src="@($"{MainDomain}image/united-states.png")" width="20" alt="EN">
                </a>
            </div>
        </div>
    </div>
</header>

<div class="offcanvas offcanvas-start" tabindex="-1" id="hpOffcanvas">
    <div class="offcanvas-header">
        <img src="@($"{MainDomain}image/logo.png")"
             class="hp-header-logo"
             onerror="this.src='/image/default-logo.png'">

        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>

    <div class="offcanvas-body">

        <div class="mb-3">Menu</div>

        <a href="@($"{MainDomain}gioi-thieu-chung-3.html")" class="hp-header-link d-block mb-2">Giới thiệu</a>
        <a href="https://techport.vn/startup-products/" class="hp-header-link d-block mb-2">SP khởi nghiệp</a>
        <a href="https://techport.vn/tech-event/" class="hp-header-link d-block mb-2">Tech event</a>
        <a href="@($"{MainDomain}thao-luan.html")" class="hp-header-link d-block mb-2">Thảo luận</a>
        <a href="@($"{MainDomain}lien-he-74.html")" class="hp-header-link d-block mb-3">Liên hệ</a>

        <hr />

        <div class="mb-2">Ngôn ngữ</div>

        <div class="d-flex gap-2 mb-3">
            <a class="hmf active" href="#">
                <img src="@($"{MainDomain}image/vietnam.png")" width="20"> Tiếng Việt
            </a>
            <a class="hmf" href="https://techport.vn/en/index.html">
                <img src="@($"{MainDomain}image/united-states.png")" width="20"> Tiếng Anh
            </a>
        </div>

        <hr />

        <div class="mb-2">Công nghệ & Thiết bị</div>

        <div class="d-flex flex-wrap gap-2">
            <a class="hm" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/dien-dien-tu-cong-nghe-thong-tin-4.html")">Điện, điện tử, CNTT</a>
            <a class="hm" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/moi-truong-9.html")">Môi trường</a>
            <a class="hm" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/cong-nghe-nano-11.html")">Công nghệ Nano</a>
            <a class="hm" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/y-hoc-8.html")">Y học</a>
            <a class="hm" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/co-khi-5.html")">Cơ khí</a>
            <a class="hm" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/vat-lieu-luyen-kim-7.html")">Vật liệu & luyện kim</a>
            <a class="hm" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/duoc-hoc-13.html")">Dược học</a>
            <a class="hm" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/chan-nuoi-15.html")">Chăn nuôi</a>
            <a class="hm" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/thuy-san-18.html")">Thuỷ sản</a>
            <a class="hm" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/trong-trot-14.html")">Trồng trọt</a>
            <a class="hm" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/cong-nghe-sinh-hoc-10.html")">Công nghệ sinh học</a>
            <a class="hm" href="@($"{MainDomain}2-ds-cong-nghe-thiet-bi/lam-nghiep-17.html")">Lâm nghiệp</a>
        </div>

    </div>
</div>
