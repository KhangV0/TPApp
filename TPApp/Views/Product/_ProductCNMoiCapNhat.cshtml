@using TPApp.Entities
@using TPApp.Controllers
@model List<SanPhamCNTB>

<div class="col-12">
    <div class="body-carousel">
        <h2 class="brand-showcase-title" style="color:#046dbd;">
            <a href="cong-nghe-thiet-bi-2.html">CÔNG NGHỆ MỚI CẬP NHẬT</a>
        </h2>

        <div id="carouselTechCombined"
             class="carousel slide over-flow"
             data-bs-ride="carousel">

            <div class="carousel-inner">
                @{
                    var chunkSize = 4; // Display 4 items per slide
                    var chunks = Model.Chunk(chunkSize).ToList();
                }

                @for (int i = 0; i < chunks.Count; i++)
                {
                    <div class="carousel-item @(i == 0 ? "active" : "")">
                        <div class="row">
                            @foreach (var p in chunks[i])
                            {
                                string imgUrl;
                                if (string.IsNullOrEmpty(p.QuyTrinhHinhAnh))
                                {
                                    imgUrl = p.TypeId switch
                                    {
                                        2 => $"{Html.MainDomain()}images/sangche.png",
                                        3 => $"{Html.MainDomain()}images/research.jpg",
                                        _ => $"{Html.MainDomain()}images/research.jpg"
                                    };
                                }
                                else
                                {
                                    // Use static method
                                    imgUrl = TPApp.Controllers.ProductController.CookedImageURL("254-170", p.QuyTrinhHinhAnh, Html.MainDomain());
                                }
                                
                                var detailUrl = $"{Html.MainDomain()}2-cong-nghe-thiet-bi/{p.TypeId}/{ProductController.MakeURLFriendly(p.Name)}-{p.ID}.html";

                                <div class="col-sm-3 col-6">
                                    <div class="product-container" style="margin-bottom: 20px;">
                                        <div class="left-block">
                                            <a href="@detailUrl">
                                                <img src="@imgUrl" class="img-responsive ProductListImage" alt="@p.Name" style="width:100%; height:auto;" />
                                            </a>
                                            @if (p.TypeId == 2)
                                            {
                                                <div class="label_sc"></div>
                                            }
                                            else if (p.TypeId == 3)
                                            {
                                                <div class="label_nc"></div>
                                            }
                                        </div>
                                        <div class="right-block">
                                            <h5 class="product-name" style="height: 40px; overflow: hidden;">
                                                <a href="@detailUrl" title="@p.Name">@p.Name</a>
                                            </h5>
                                             <div class="content_price">
                                                <span class="price product-price">
                                                    @if (p.OriginalPrice > 0)
                                                    {
                                                        @ProductController.FormatCurrencyOto((decimal?)p.OriginalPrice, p.Currency)
                                                    }
                                                    else
                                                    {
                                                       <span>Liên hệ</span>
                                                    }
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>

            <button class="carousel-control-prev"
                    type="button"
                    data-bs-target="#carouselTechCombined"
                    data-bs-slide="prev"
                    style="width: 5%; background: rgba(0,0,0,0.2);">
                <span class="carousel-control-prev-icon"></span>
            </button>

            <button class="carousel-control-next"
                    type="button"
                    data-bs-target="#carouselTechCombined"
                    data-bs-slide="next"
                    style="width: 5%; background: rgba(0,0,0,0.2);">
                <span class="carousel-control-next-icon"></span>
            </button>

        </div>
    </div>
</div>